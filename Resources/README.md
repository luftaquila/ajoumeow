[main.js](https://github.com/luftaquila/ajoumeow/blob/master/Resources/main.js)
=============
사이트의 전반적인 동작을 제어하는 스크립트 파일입니다.

## 0. $(function())
사이트 초기 로드 완료 시 제일 먼저 호출됩니다.
## 1. load()
급식표 정보를 DB에서 불러옵니다.
1. 모든 입력 필드를 비활성화하고, Latest Update 요소 내용을 'Loading...'으로 변경합니다.
1. 새로고침 아이콘에 회전 클래스 'rotating'을 추가합니다.
1. 공지사항의 마지막 업데이트 내역에 버전 및 업데이트 날짜 정보를 설정합니다.
1. About 페이지에 전달할 파라미터를 설정합니다.
1. DB의 **Record** 시트의 csv 데이터를 로드해 `newYourNameIs()` 함수에 파라미터로 전달합니다.
1. 이번 달 및 저번 달 마일리지 1 ~ 3위 정보를 로드해 랭킹 팝업에 표시합니다.

## 2. newYourNameIs(response)
급식표 데이터를 6 * 21 사이즈 2차원 배열 `table`에 저장하는 함수입니다.
1. 파라미터로 전달받은 **Record** 시트 데이터를 파싱해 2차원 배열 `datum`에 저장합니다.
1. 급식표에 표시될 일정 데이터를 급식표를 좌상-우하 대각선으로 반전시킨 형태의 배열 `table`에 저장합니다.
    * `table`의 각 행은 한 날짜의 급식 데이터 배열입니다. 배열 구조는 다음과 같습니다.  
    [1일차 1코스 첫번째][1일차 1코스 두번째]...[1일차 3코스 두번째]  
    [2일차 1코스 첫번째]          ...         [2일차 3코스 두번째]  
    ...  
    [21일차 1코스 첫번째          ...         [21일차 3코스 두번째]  
    * 같은 이름이 연속으로 등장하면 한 번만 인식합니다. 한 사람의 코스 독점을 방지합니다.
1. 급식표에 데이터를 배치하는 `setData()` 함수를 호출합니다.

## 3. setData(table)
급식표 이름 데이터를 포함한 각종 데이터를 화면에 표시합니다.
1. Latest Update 요소를 현재 시간으로 설정합니다.
1. 관리자 모드 활성화를 검출하는 이벤트 리스너를 설정합니다.
1. 표의 날짜 셀과 이름 셀에 맞는 데이터를 `table`에서 찾아 채워넣습니다.
1. 급식표에서 오늘 날짜를 하이라이팅합니다.
1. 페이지 버전이 바뀌었다면 공지사항 팝업을 표시합니다.
1. `fillName` 이름 자동완성 쿠키 데이터가 없다면 이름을 묻는 팝업을 표시합니다.
1. 급식표에 표시해야 할 일정을 `setCalendar()` 함수를 호출해 설정합니다.
1. 새로고침 아이콘의 회전을 정지하고 입력 필드를 활성화합니다.

## 4. validator(operationType, targetID, targetName, originalName)
신청/수정/삭제 내용에 대한 유효성 검사를 수행합니다.
* [필터링 조건](https://github.com/luftaquila/ajoumeow/blob/master/Markdown/MANUAL.md#-%EC%9E%85%EB%A0%A5-%ED%95%84%ED%84%B0%EB%A7%81) 참조

## 5. transmitter(submitType)
신청 및 수정, 삭제 내용을 서버로 전송합니다.
1. 모든 입력 필드를 비활성화합니다.
1. 전송할 데이터를 serialize해 Google Apps Script 프로젝트에 전송합니다.
* 전송에 성공하면 `load()` 함수를 호출해 급식표를 새로고침하고 성공 알림을 표시합니다. `fillName` 쿠키를 업데이트합니다.
* 전송에 실패하면 에러 메시지와 오류 정보를 표시합니다.
* 성공 여부에 관계없이 모든 입력 필드를 활성화합니다.

## 6. locator(targetID)
선택된 셀의 ID값을 바탕으로 해당 셀의 날짜와 코스 데이터를 판단해 반환합니다.

## 7. setCalendar(targetDate, targetText, isRainbow)
급식표에 표시할 일정을 설정합니다.
* `targetDate` 파라미터는 표시할 일정의 날짜를 지정합니다. m/d(ddd) 형식의 날짜 텍스트여야 합니다.
* `targetText` 파라미터는 표시할 일정의 이름을 지정합니다.
* `isRainbow` 파라미터는 표시할 일정이 무지갯빛으로 반짝이게 할 지를 설정합니다.
1. 급식표에서 `targetDate`와 일치하는 텍스트를 찾아 `targetText`로 변경합니다.
1. 무지갯빛으로 빛나는 일정이 존재하면 무지개로 빛나지 않게 하는 체크박스를 표시합니다.

## 8. dataSize(s, b, i, c)
송/수신 데이터의 크기를 계산하여 리턴하는 함수입니다.

## 9. popupBlocker()
랭킹 팝업에서 *3일간 다시 보지 않기* 를 클릭했을 경우 팝업을 닫고 3일 후 만료되는 쿠키를 생성합니다.

## 10. mileageDisplayer()
랭킹 팝업에서 *마일리지 현황 보기* 를 를 클릭했을 경우 팝업을 닫고 마일리지 현황 팝업을 표시합니다.

## 11. updateLogDisplayer()
공지사항 팝업에서 *업데이트 로그 보기* 를 클릭했을 경우 누적 업데이트 기록을 표시하거나 닫습니다.

## 12. clickEventListener()
여러 요소들의 클릭 시 이벤트를 설정합니다.  
오늘 날짜가 평일이면 `평일` 탭을, 주말이면 `주말` 탭을  표시합니다.

## 13. loadWeather()
날씨 정보를 로드해 표시합니다.

## 14. contextLoader()
급식표에서 셀을 선택했을 때 표시되는 창의 속성을 설정합니다.

## ~~yourNameIs(p1, p2, course, rank)~~ *Deprecated*
~~급식표의 각 이름 셀에 들어갈 이름을 결정하는 함수입니다.~~  
* ~~`course` 파라미터는 무슨 코스인지를 결정합니다.~~
* ~~`rank` 파라미터는 해당 날짜 해당 코스의 첫 번째 셀인지, 두 번째 셀인지를 결정합니다.~~  

1. ~~함수를 호출한 셀의 날짜를 결정해 `result` 변수에 저장합니다.~~
    * ~~`p1` 변수는 주 오프셋을 결정합니다. 몇 번째 주인지를 설정하는 파라미터입니다.~~
    * ~~`p2` 변수는 일 오프셋을 결정합니다. 그 주의 몇 번째 날인지를 설정합니다.~~
1. ~~rank와 날짜, 코스에 맞는 이름을 `datum` 배열에서 찾아 리턴합니다.~~
    * ~~같은 이름이 연속으로 등장하면 한 번만 인식합니다. 한 사람의 코스 독점을 방지합니다.~~
    * ~~일치하는 결과가 없으면 공백을 리턴합니다. 급식표에 공백 란이 표시됩니다.~~
