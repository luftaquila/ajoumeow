<html>
  <head>
    <title>Statistics Overview</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="LdumQ1csatc-sergk4eQ5nBhKjcnisZ18Bo8RjRBxKo"/>
    <meta name="naver-site-verification" content="f3183dc84e33039873fc22ec89ee6b402fe3c54d"/>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119383265-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'UA-119383265-1');
    </script>
  </head>
  <body style="-ms-user-select: none; -moz-user-select: -moz-none; -webkit-user-select: none; -khtml-user-select: none; user-select:none;">
    Status : <span id="status" style="color:#ffbf00">Loading Data...</span><span style="line-height:50%"><br><br></span>
    이름 : <select id='name' name='name' size='1' style='width:100px' onchange='load();' disabled='disabled'></select><span style="line-height:90%"><br><br></span>
    <div id='thisMonth'></div>
    <div id='totalTime'></div>
    <script>
      $(function() {
        nameList = [], data = [], downloadSize = 0;
        $.ajax({
          url: 'https://docs.google.com/spreadsheet/pub?key=1j41TAb8itKVq2X2c-pSpRgIpGeMrt-95ePrkAhe4Vec&single=true&gid=1900667290&sheet=Statistics&range=M3:M&output=csv',
          type: "GET",
          dataType: 'text',
          cache: false,
          success: function (response) {
            nameList = response.split('\n').map((line) => line.split(','));
            downloadSize += dataSize(response);
            $.ajax({
              url: 'https://docs.google.com/spreadsheet/pub?key=1j41TAb8itKVq2X2c-pSpRgIpGeMrt-95ePrkAhe4Vec&single=true&gid=779005898&sheet=Authorized&range=A2:D&output=csv',
              type: "GET",
              dataType: 'text',
              cache: false,
              success: function (response) {
                data = response.split('\n').map((line) => line.split(','));
                downloadSize += dataSize(response);
                $('#status').css('color', '#15be00');
                $('#status').text('200 Ready. ' + (downloadSize / 1000).toFixed(1) + 'KB Loaded');
                $('select').attr('disabled', false);
                genDropDown();
              }
            });
          }
        });
      });
      function load() {
        var thisMonth = '<table style="text-align:center;"><tr><td colspan="4">' + new Date().getFullYear() + '년 ' + (new Date().getMonth() + 1) + '월 활동 내역</td></tr><tr height="30"><td>날짜</td><td>이름</td><td>코스</td><td>점수</td></tr>';
        var totalTime = '<table style="text-align:center;"><tr><td colspan="4"><hr style="width:auto;border-bottom:0px;text-align:left;margin-left:0px"></td></tr><tr><td colspan="4">전 기간 활동 내역</td></tr><tr height="30"><td>날짜</td><td>이름</td><td>코스</td><td>점수</td></tr>';
        data.forEach(function(value) {
          if(new Date(value[0]).getMonth() == new Date().getMonth() && $('#name').val() == value[1]) { thisMonth += '<tr><td>' + value[0] + '</td><td>' + value[1] + '</td><td>' + value[2] + '</td><td>' + value[3] + '</td></tr>'; }
          if($('#name').val() == value[1]) { totalTime += '<tr><td>' + value[0] + '</td><td>' + value[1] + '</td><td>' + value[2] + '</td><td>' + value[3] + '</td></tr>'; }
        });
        $('#thisMonth').html(thisMonth + '</table>');
        $('#totalTime').html(totalTime + '</table>');
        Cookies.set('name', $('#name').val(), {expires : 7});
      }
      function genDropDown() {
        var str = "", isSelected = "";
        nameList.forEach(function(value) {
          if(value[0].includes(Cookies.get('name'))) { console.log("selected"); isSelected = " selected" }
          str += '<option value=' + value + isSelected + '>' + value + '</option>';
          isSelected = "";
        });
        $('#name').html(str);
        if(Cookies.get('name') != null) { load(); }
      }
      function dataSize(s, b, i, c) { for(b = i = 0; c = s.charCodeAt(i++); b += c >> 11 ? 3 : c >> 7 ? 2 : 1); return b; }
    </script>
    <script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
    <script type="text/javascript">
      if(!wcs_add) var wcs_add = {};
      wcs_add["wa"] = "89774287089c10";
      wcs_do();
    </script>
    <style> th, td { padding:0 15 0 0; } </style>
  </body>
</html>
